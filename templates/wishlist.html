{% extends "index.html" %}
{% block title %}내 찜 목록{% endblock %}

{% block content %}
<h2 style="text-align:center; margin:40px 0; font-weight:800;">내 찜 목록</h2>

{% if datas|length == 0 %}
<p style="text-align:center; margin-top:50px;">아직 찜한 상품이 없습니다.</p>
{% else %}

<div class="item-grid">
  {% for key, value in datas %}
  <div class="item-card">
    
    <!-- 상품 이미지 -->
<a href="{{ url_for('view_item_detail', name=key) }}">
      <img
        src="{{ url_for('static', filename='images/' ~ value.img_path) }}"
        alt="{{ key }}"
        class="item-img"
        onerror="this.src='{{ url_for('static', filename='images/placeholder.png') }}'">

 </a>


    <!-- 상품 정보 -->
    <div class="item-info">
      <h3><a href="{{ url_for('view_item_detail', name=key) }}">{{ key }}</a></h3>
      <p>{{ value.price }}원</p>
      <p>{{ value.addr }}</p>
    </div>

    <!-- 하트 버튼 -->
    <span class="heart-icon {% if value.interested == 'Y' %}liked{% endif %}" onclick="toggleLike('{{ key }}', this)">
      ♥
    </span>
  </div>
  {% endfor %}
</div>

{% endif %}

<script src="https://code.jquery.com/jquery-latest.min.js"></script>
<script>
function toggleLike(pid, el) {
  // 클릭 시 잠시 비활성화 (중복 클릭 방지)
  $(el).css("pointer-events", "none");

  $.ajax({
    type: "POST",
    url: "/unlike/" + pid + "/",
    success: function(res) {
      // 하트 색상 제거
      $(el).removeClass('liked');

      // 카드 부드럽게 제거
      $(el).closest('.item-card').fadeOut(250, function() {
        $(this).remove();

        // 카드가 모두 사라졌을 경우 메시지 출력
        if ($('.item-card').length === 0) {
          $('.item-grid').html('<p style="text-align:center; margin-top:40px;">찜한 상품이 없습니다.</p>');
        }
      });
    },
    error: function(err) {
      alert('서버 오류 발생');
      console.error(err);
    },
    complete: function() {
      // 클릭 다시 활성화
      $(el).css("pointer-events", "auto");
    }
  });
}
</script>


{% if page_count > 1 %}
<div class="pagination">
  {% if page > 1 %}
    <a href="{{ url_for('wishlist', page=page-1) }}" class="page-arrow">«</a>
  {% else %}
    <span class="page-arrow disabled">«</span>
  {% endif %}

  {% for i in range(1, page_count + 1) %}
    {% if i == page %}
      <span class="page-number active">{{ i }}</span>
    {% else %}
      <a href="{{ url_for('wishlist', page=i) }}" class="page-number">{{ i }}</a>
    {% endif %}
  {% endfor %}

  {% if page < page_count %}
    <a href="{{ url_for('wishlist', page=page+1) }}" class="page-arrow">»</a>
  {% else %}
    <span class="page-arrow disabled">»</span>
  {% endif %}
</div>
{% endif %}


<style>
.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 40px;
  gap: 15px;
  font-size: 18px;
  font-family: "Noto Sans KR", sans-serif;
}

.page-number, .page-arrow {
  color: #00462a;
  text-decoration: none;
  padding: 5px 10px;
  border-radius: 5px;
  transition: all 0.2s ease-in-out;
}

.page-number:hover,
.page-arrow:hover {
  background-color: #00462a;
  color: #fff;
}

.page-number.active {
  background-color: #00462a;
  color: #fff;
  font-weight: 700;
}

.page-arrow.disabled {
  color: #aaa;
  pointer-events: none;
}
</style>

<style>
/* ✅ 리스트(list.html)와 동일한 레이아웃 적용 */
* { box-sizing: border-box; }

.item-grid-wrapper {
  margin: 0 auto;
  max-width: 1800px;
}

.item-grid {
  display: grid;
  grid-template-columns: repeat(5, minmax(190px, 1fr));  /* 한 줄에 5개 */
  gap: 10px;
}

.item-card {
  width: 100%;
  padding: 9px;
  text-align: left;
  border: 1px solid #eee;
  background: #fff;
  border-radius: 10px;
  position: relative;
}

.item-card img {
  width: 100%;
  height: 160px;             /* list.html과 동일 */
  object-fit: cover;
  border-radius: 8px;
}

/* 텍스트 스타일도 동일하게 */
.item-info h3 {
  font-size: 16px;
  color: #00462a;
  margin-top: 6px;
  margin-bottom: 4px;
}

.item-info p {
  margin: 2px 0;
  color: #333;
  font-size: 14px;
}

/* ❤️ 하트 위치는 동일하게 유지 */
.heart-icon {
  font-size: 22px;
  cursor: pointer;
  position: absolute;
  right: 12px;
  bottom: 12px;
  color: grey;
}
.heart-icon.liked {
  color: #ff3b3b;
}
</style>

{% endblock %}
