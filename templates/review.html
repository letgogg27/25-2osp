{% extends "index.html" %}
{% block title %}Ewha Market - Review List{% endblock %}
{% block content %}
{% set total = total | default(0) %}

<h2 class="page-title">이화마켓 리뷰 목록</h2>

<style>
  .item-grid-wrapper { margin: 30 auto; max-width: 1800px; }
  .item-grid { display: grid; grid-template-columns: repeat(5, minmax(190px, 1fr)); }
  .item-card { width: 100%; text-align: left; border: 1px solid #eee; background: #fff; }
  .item-card img { width: 100%; height: 160px; object-fit: cover; }
  .pager { margin-top: 24px; margin-bottom: 80px; }
</style>

<div class="search-bar">
  <form class="search-form" method="GET" action="{{ url_for('view_review') }}">
    <input type="text" name="q" placeholder="판매자명 또는 상품명 검색" value="{{ q | default('') }}"/> 
    <select name="sort" onchange="this.form.submit()">
      <option value="" {% if sort == '' %}selected{% endif %}>최신순</option>
      <option value="star_asc" {% if sort == 'star_asc' %}selected{% endif %}>별점 낮은 순</option>
      <option value="star_desc" {% if sort == 'star_desc' %}selected{% endif %}>별점 높은 순</option>
    </select>
    <button type="submit">검색</button>
  </form>
</div>

{% if total > 0 %}
<p class="item-count-text">{{ total }}개 리뷰 등록됨</p>
<!--<p>{{ total }}개 등록됨</p>-->

<!-- 리뷰 카드 리스트 -->
<ul class="card-list">
  {% for key, review in datas %}
  <li class="card" onclick="location.href='{{ url_for('view_review_detail', name=key) }}';" style="cursor:pointer">

    <div>
      <div class="review-header">

        <!-- 작성자 프로필 이미지 -->
        <div class="profile-pic">
          <img src="/static/images/{{ review.profile_img }}" alt="프로필" />
        </div>

        <div>
          <!-- 작성자 아이디 -->
          <div class="review-user">
            @{{ review.user }}
          </div>

          <!-- ⭐ 실제 별점 수만큼 별 표시 -->
          <div class="review-rating">
            {% for i in range(review.rate | int) %}
              ⭐
            {% endfor %}
            <span>{{ review.rate }}</span>
          </div>
        </div>
      </div>

      <!-- 제목 + 내용 -->
      <div class="review-content">
        <strong>“{{ review.title }}”</strong>
        <p>{{ review.review }}</p>
      </div>

      <!-- 리뷰 이미지 -->
      {% if review.img_path %}
      <a class="thumb">
        <img src="/static/images/{{ review.img_path }}" alt="리뷰 이미지" />
      </a>
      {% endif %}

      <!-- 해시태그 (pros 값 활용) -->
      {% if review.pros %}
      <div class="hashtags">
      {% for tag in review.pros.split(", ") %}
      <span>#{{ tag }}</span>
      {% endfor %}
      </div>
      {% endif %}

    </div>

    <div class="review-footer">
      <div class="helpful">도움돼요 {{ review.helpful }}</div>
      <div class="review-date">{{ review.date }}</div>
    </div>

  </li>
  {% endfor %}
</ul>

<!-- 페이지네이션 -->
<div class="pager">
  {% if page > 1 %}
    <a href="{{ url_for('view_review', page=page-1, sort=sort, q=q) }}" class="page-ctrl" aria-label="이전">&laquo;</a>
  {% else %}
    <span class="page-ctrl disabled" aria-label="이전">&laquo;</span>
  {% endif %}

  <ol class="page-list">
    {% for i in range(1, page_count + 1) %}
    <li class="{% if i == page %}on{% endif %}">
      <a href="{{ url_for('view_review', page=i, sort=sort, q=q) }}">{{ i }}</a>
    </li>
    {% endfor %}
  </ol>

  {% if page < page_count %}
    <a href="{{ url_for('view_review', page=page+1, sort=sort, q=q) }}" class="page-ctrl" aria-label="다음">&raquo;</a>
  {% else %}
    <span class="page-ctrl disabled" aria-label="다음">&raquo;</span>
  {% endif %}
</div>

{% else %}
<p>등록된 리뷰가 없습니다.</p>
{% endif %}

{% endblock %}
