{% extends "index.html" %}
{% block title %} 리뷰 작성하기 {% endblock %}
{% block content %}

<style>
  #drop-preview {
    width: 100%;
    margin-top: 12px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
  }

  #drop-preview img {
    width: 120px;
    height: 120px;
    border-radius: 8px;
    object-fit: cover;
    border: 1px solid #ddd;
  }
</style>

<main class="reg-review-container">
  <h2>거래 후기</h2>
  <!--상품 및 판매자정보 -->
  <section class="info-box review">
    <div class="product-info-box review">
      <div class="product-thumb review">
        <img src="{{ url_for('static', filename='images/' ~ data.img_path) }}" alt="상품이미지">
      </div>
      <div class="product-info review">
        <p class="product-title review">{{ name }}</p>
        <p class="product-price review">₩{{ data.price }}</p>
      </div>
    </div>

    <div class="review-seller-info-box">
      <div class="review-seller-thumb-avatar">E</div>
      <div class="review-seller-info">
        <p class="review-seller-id">@{{ data.seller }}</p>
        <small class="review-seller-address">{{ data.addr }}</small>
      </div>
    </div>
  </section>

  <!-- 리뷰 작성 폼 -->
  <form class="review-box" method="post" action="/reg_review" enctype="multipart/form-data">

    <input type="hidden" name="name" value="{{ name }}">

    <!-- 별점 -->
    <fieldset>
      <legend><i class="fa-regular fa-star"></i>별점을 주세요!</legend>
      <div class="stars" id="stars">
        {% for i in range(1, 6) %}
        <button type="button" class="star-btn" data-value="{{ i }}">★</button>
        {% endfor %}
      </div>
      <input type="hidden" name="rating" id="rating" value="0" />
    </fieldset>

    <!-- 좋았던 점 -->
    <fieldset>
      <legend><i class="fa-solid fa-t"></i>어떤 점이 좋았나요?</legend>
      <div class="chips" id="chipGroup">
        <span class="chip">친절했어요</span>
        <span class="chip">시간 약속을 잘 지켜요</span>
        <span class="chip">응답이 빨라요</span>
        <span class="chip">설명과 같아요</span>
        <span class="chip">상품 상태가 좋아요</span>
        <span class="chip">좋은 가격이에요</span>
      </div>
      <input type="hidden" name="pros" id="pros">
    </fieldset>

    <!-- 이미지 업로드 -->
    <fieldset>
      <legend><i class="fa-regular fa-image"></i> 리뷰 이미지 업로드</legend>

      <label class="drop" for="images">
        <div><i class="fa-solid fa-plus"></i></div>
        <div class="text-main">이미지를 업로드하세요.</div>
        <div class="text-sub">JPG, PNG만 가능</div>

        <!-- ⭐ 미리보기 컨테이너 -->
        <div id="drop-preview"></div>

        <!-- ⭐ 여러 장 업로드 -->
        <input
          id="images"
          name="images[]"
          type="file"
          accept="image/png,image/jpeg"
          multiple
        />
      </label>

    </fieldset>

    <!-- 제목 -->
    <fieldset>
      <legend><i class="fa-regular fa-message"></i>리뷰 제목</legend>
      <textarea class="textarea" name="title"></textarea>
    </fieldset>

    <!-- 내용 -->
    <fieldset>
      <legend><i class="fa-regular fa-message"></i>리뷰 내용</legend>
      <textarea class="textarea" name="content"></textarea>
    </fieldset>

    <div class="reg-review-btn-actions">
      <button type="reset" class="reg-review-btn secondary">취소</button>
      <button type="submit" class="reg-review-btn primary">후기 등록하기</button>
    </div>
  </form>
</main>

<!-- ⭐ 이미지 미리보기 스크립트 (최종 정리본) -->
<script>
document.getElementById("images").addEventListener("change", function (event) {
  const preview = document.getElementById("drop-preview");
  preview.innerHTML = "";  // 이전 이미지 전부 삭제

  const files = [...event.target.files];

  files.forEach(file => {
    const reader = new FileReader();
    reader.onload = function(e) {
      const img = document.createElement("img");
      img.src = e.target.result;
      preview.appendChild(img);
    };
    reader.readAsDataURL(file);
  });
});
</script>

{% endblock %}
